<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Switchable HLS Streams with Key Display</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
    }

    button {
      margin: 0px;
      padding: 10px 68px;
      font-size: 16px;
    }

    video {
      display: block;
      margin: 20px 0;
    }

    #keyDisplay {
      font-size: 24px;
      font-family: monospace;
      padding: 10px;
      border: 2px solid #444;
      width: fit-content;
      background: #f0f0f0;
      margin-top: 10px;
    }

    video::-webkit-media-controls {
        display: none !important;
    }
  </style>
</head>
<body tabindex="0" onload="document.body.focus()">

  <div style="
    justify-content: space-around;
    display: flex;
    /* margin: 0 200px; */
">
    <button onclick="playStream(0)">11</button>
    <button onclick="playStream(1)">12</button>
    <button onclick="playStream(2)">13</button>
    <button onclick="playStream(3)">14</button>
  </div>

  <video id="video" autoplay muted controls 
  style="
    width: 100%;
    /* height: 942px; */
    margin: 0;
"></video>


  <div style="
    justify-content: space-around;
    display: flex;
    /* margin: 0 200px; */
">
  <button id="fullscreenButton" onclick="toggleFullScreen()">Full Screen</button>
  <button id="muteButton" onclick="toggleMute()">Mute</button>
</div>

  <!-- <div id="keyDisplay">Last key: <span id="lastKey">None</span></div> -->

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const streams = [
    () => 'https://kan11w.media.kan.org.il/hls/live/2105694/2105694/master.m3u8',
    async () => {
        const response = await fetch('https://mass.mako.co.il/ClicksStatistics/entitlementsServicesV2.jsp?et=gt&lp=/stream/hls/live/2033791/k12n12wad/index.m3u8?b-in-range=0-700&rv=AKAMAI');
        const json = await response.json();
        const url = `https://mako-streaming.akamaized.net${json.tickets[0].url}&${json.tickets[0].ticket}`;
        return url;
    },
    () => 'https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8',
    () => 'https://ch14-channel14-content.akamaized.net/hls/live/2104807/CH14_CHANNEL14/2/streamPlaylist.m3u8'
    ];


    const video = document.getElementById('video');
    const lastKeySpan = document.getElementById('lastKey');
    let hls;
    let currentStreamIndex = 0;

    async function playStream (index) {
        currentStreamIndex = index;
        const src = await streams[index](); // âœ¨ Now call the function to get the URL

        if (hls) {
            hls.destroy();
        }

        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(src);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.muted = false;
            video.play().catch(err => {
                console.warn('Autoplay with sound failed:', err);
            });
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = src;
            video.muted = false;
            video.play().catch(err => {
            console.warn('Autoplay with sound failed:', err);
            });
        } else {
            alert('Your browser does not support HLS.');
        }
    }

    function toggleFullScreen() {
        const videoContainer = video;

        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(() => {
              document.getElementById('fullscreenButton').textContent = 'Exit Full Screen';
            }).catch(err => {
            console.error(`Error attempting to enable full-screen mode: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
            document.getElementById('fullscreenButton').textContent = 'Full Screen';
            
        }
    }

    function toggleMute() {
        video.muted = !video.muted;
        document.getElementById('muteButton').textContent = video.muted ? 'Unmute' : 'Mute';
    }

    window.addEventListener('load', () => {
        // playStream(0);
        // setTimeout(() => {
        // },3000)
    });

    document.addEventListener('keydown', (e) => {
    //   lastKeySpan.textContent = e.key;

      if (['ArrowRight', 'PageUp'].includes(e.key)) {
        playStream((currentStreamIndex + 1) % streams.length);
      } else if (['ArrowLeft', 'PageDown'].includes(e.key)) {
        playStream((currentStreamIndex - 1 + streams.length) % streams.length);
      } else if (e.key === 'f') {
        toggleFullScreen();
      } else if (e.key === 'm') {
        toggleMute();
      } else if ([1, 2, 3, 4].includes(parseInt(e.key))) {
        playStream(parseInt(e.key) - 1);
      }
    });
  </script>
</body>
</html>



