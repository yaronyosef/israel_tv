<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Switchable HLS Streams with Key Display</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
    }

    button {
      margin: 0px;
      padding: 5%;
      font-size: 200%;
    }

    video {
      display: block;
      margin: 20px 0;
    }

    #keyDisplay {
      font-size: 24px;
      font-family: monospace;
      padding: 10px;
      border: 2px solid #444;
      width: fit-content;
      background: #f0f0f0;
      margin-top: 10px;
    }

    video::-webkit-media-controls {
        display: none !important;
    }
  </style>
</head>
<body tabindex="0" onload="document.body.focus()">

  <video id="video" autoplay muted controls 
  style="
    /* width: 100%; */
    /* height: 942px; */
    margin: 0px auto;
"
onclick="toggleButtonsVisibility()"
></video>

  <div id="buttons" style="display: none">

    <div style="
      justify-content: space-around;
      display: flex;
      position: absolute;
      width: 100%;
      top: 0;
  ">
      <button onclick="playStream(0)">11</button>
      <button onclick="playStream(1)">12</button>
      <button onclick="playStream(2)">13</button>
      <button onclick="playStream(3)">14</button>
    </div>


    <div style="
      justify-content: space-around;
      display: flex;
      position: absolute;
      width: 100%;
      bottom: 0;
  ">
    <button id="fullscreenButton" onclick="toggleFullScreen()">Full Screen</button>
    <button id="muteButton" onclick="toggleMute()">Mute</button>
  </div>

  </div>


  <!-- <div id="keyDisplay">Last key: <span id="lastKey">None</span></div> -->

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const streams = [
    () => 'https://kan11w.media.kan.org.il/hls/live/2105694/2105694/master.m3u8',
    async () => {
        const response = await fetch('https://mass.mako.co.il/ClicksStatistics/entitlementsServicesV2.jsp?et=gt&lp=/stream/hls/live/2033791/k12n12wad/index.m3u8?b-in-range=0-700&rv=AKAMAI');
        const json = await response.json();
        const url = `https://mako-streaming.akamaized.net${json.tickets[0].url}&${json.tickets[0].ticket}`;
        return url;
    },
    () => 'https://d198ztbnlup2iq.cloudfront.net/out/v1/2d9050c90fb94df8b78d1d98306a1a65/index.m3u8',
    () => 'https://n-121-5.il.cdn-redge.media/livehls/oil/ch14/live/ch14/live.livx/playlist.m3u8?bitrate=928000&audioId=1&videoId=12',
    // () => 'https://ch14-channel14-content.akamaized.net/hls/live/2104807/CH14_CHANNEL14/2/streamPlaylist.m3u8'
    ];


    const video = document.getElementById('video');

    updateVideoSize();

    const buttons = document.getElementById('buttons');

    const lastKeySpan = document.getElementById('lastKey');
    let hls;
    let currentStreamIndex = 0;

    async function playStream(index) {
        hideButtonsVisibility(false);

        currentStreamIndex = index;
        const src = await streams[index](); // âœ¨ Now call the function to get the URL

        if (hls) {
            hls.destroy();
        }

        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(src);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.muted = false;
            video.play().catch(err => {
                console.warn('Autoplay with sound failed:', err);
            });
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = src;
            video.muted = false;
            video.play().catch(err => {
            console.warn('Autoplay with sound failed:', err);
            });
        } else {
            alert('Your browser does not support HLS.');
        }
    }

    function toggleFullScreen() {
        hideButtonsVisibility();
        const videoContainer = video;

        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(() => {
              document.getElementById('fullscreenButton').textContent = 'Exit Full Screen';
            }).catch(err => {
            console.error(`Error attempting to enable full-screen mode: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
            document.getElementById('fullscreenButton').textContent = 'Full Screen';
            
        }
    }

    function toggleMute() {
        hideButtonsVisibility();
        video.muted = !video.muted;
        document.getElementById('muteButton').textContent = video.muted ? 'Unmute' : 'Mute';
        updateVideoSize();
    }

    function updateVideoSize() {
      // const div = document.getElementById('myDiv');
      const width = window.innerWidth;
      const height = window.innerHeight;

      if (width > height) {
        // Set height to 100% of viewport height in pixels
        video.style.height = height + 'px';
        video.style.width = 'auto'; // Optional: reset width
      } else {
        // Set width to 100% of viewport width in pixels
        video.style.width = width + 'px';
        video.style.height = 'auto'; // Optional: reset height
      }
    }

    function hideButtonsVisibility() {
      buttons.style.display = 'none';
    }

    function toggleButtonsVisibility() {
      if (buttons.style.display === 'none') {
        buttons.style.display = 'block';
      } else {
        buttons.style.display = 'none';
      }
    }

    // function toggleButtons() {
    //   buttons.style.display = 'block';
    // }

    window.addEventListener('load', () => {
        // playStream(0);
        // setTimeout(() => {
        // },3000)
    });

    document.addEventListener('keydown', (e) => {
    //   lastKeySpan.textContent = e.key;

      if (['ArrowRight', 'PageUp'].includes(e.key)) {
        playStream((currentStreamIndex + 1) % streams.length);
      } else if (['ArrowLeft', 'PageDown'].includes(e.key)) {
        playStream((currentStreamIndex - 1 + streams.length) % streams.length);
      } else if (e.key === 'f') {
        toggleFullScreen();
      } else if (e.key === 'm') {
        toggleMute();
      } else if ([1, 2, 3, 4].includes(parseInt(e.key))) {
        playStream(parseInt(e.key) - 1);
      }
    });

    document.addEventListener('fullscreenchange', () => {
      // Wait a short moment to ensure the size has updated
      setTimeout(updateVideoSize, 100); // 100ms delay is usually enough
      setTimeout(updateVideoSize, 200); // 100ms delay is usually enough
      setTimeout(updateVideoSize, 300); // 100ms delay is usually enough
      // updateVideoSize();
    });
  </script>
</body>
</html>



